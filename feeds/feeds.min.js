var Datajet=Datajet||{};
Datajet.Fingerprint=function(a){var c,e;c=Array.prototype.forEach;e=Array.prototype.map;this.each=function(a,d,e){if(null!==a)if(c&&a.forEach===c)a.forEach(d,e);else if(a.length===+a.length)for(var f=0,g=a.length;f<g&&d.call(e,a[f],f,a)!=={};f++);else for(f in a)if(a.hasOwnProperty(f)&&d.call(e,a[f],f,a)==={})break};this.map=function(a,d,c){var f=[];if(null===a)return f;if(e&&a.map===e)return a.map(d,c);this.each(a,function(a,b,e){f[f.length]=d.call(c,a,b,e)});return f};"object"==typeof a?(this.hasher=
a.hasher,this.screen_resolution=a.screen_resolution,this.screen_orientation=a.screen_orientation,this.canvas=a.canvas,this.ie_activex=a.ie_activex):"function"==typeof a&&(this.hasher=a)};
Datajet.Fingerprint.prototype={get:function(){var a=[];a.push(navigator.userAgent);a.push(navigator.language);a.push(screen.colorDepth);this.screen_resolution&&"undefined"!==typeof this.getScreenResolution()&&a.push(this.getScreenResolution().join("x"));a.push((new Date).getTimezoneOffset());a.push(this.hasSessionStorage());a.push(this.hasLocalStorage());a.push(!!window.indexedDB);document.body?a.push(typeof document.body.addBehavior):a.push("undefined");a.push(typeof window.openDatabase);a.push(navigator.cpuClass);
a.push(navigator.platform);a.push(navigator.doNotTrack);a.push(this.getPluginsString());this.canvas&&this.isCanvasSupported()&&a.push(this.getCanvasFingerprint());return this.hasher?this.hasher(a.join("###"),31):a.join("###").murmurh(31)},hasLocalStorage:function(){try{return!!window.localStorage}catch(a){return!0}},hasSessionStorage:function(){try{return!!window.sessionStorage}catch(a){return!0}},isCanvasSupported:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},
isIE:function(){return"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&/Trident/.test(navigator.userAgent)?!0:!1},getPluginsString:function(){return this.isIE()&&this.ie_activex?this.getIEPluginsString():this.getRegularPluginsString()},getRegularPluginsString:function(){return this.map(navigator.plugins,function(a){var c=this.map(a,function(a){return[a.type,a.suffixes].join("~")}).join(",");return[a.name,a.description,c].join("::")},this).join(";")},getIEPluginsString:function(){return window.ActiveXObject?
this.map("ShockwaveFlash.ShockwaveFlash;AcroPDF.PDF;PDF.PdfCtrl;QuickTime.QuickTime;rmocx.RealPlayer G2 Control;rmocx.RealPlayer G2 Control.1;RealPlayer.RealPlayer(tm) ActiveX Control (32-bit);RealVideo.RealVideo(tm) ActiveX Control (32-bit);RealPlayer;SWCtl.SWCtl;WMPlayer.OCX;AgControl.AgControl;Skype.Detection".split(";"),function(a){try{return new ActiveXObject(a),a}catch(c){return null}}).join(";"):""},getScreenResolution:function(){return this.screen_orientation?screen.height>screen.width?[screen.height,
screen.width]:[screen.width,screen.height]:[screen.height,screen.width]},getCanvasFingerprint:function(){var a=document.createElement("canvas"),c=a.getContext("2d");c.textBaseline="top";c.font="14px 'Arial'";c.textBaseline="alphabetic";c.fillStyle="#f60";c.fillRect(125,1,62,20);c.fillStyle="#069";c.fillText("http://valve.github.io",2,15);c.fillStyle="rgba(102, 204, 0, 0.7)";c.fillText("http://valve.github.io",4,17);return a.toDataURL()}};
String.prototype.trunc=function(a,c){var e=this.length>a,b=e?this.substr(0,a-1):this;return b=c&&e?b.substr(0,b.lastIndexOf(" ")):b};
String.prototype.murmurh=function(a){var c,e,b,d;c=this.length&3;e=this.length-c;b=a;for(a=0;a<e;)d=this.charCodeAt(a)&255|(this.charCodeAt(++a)&255)<<8|(this.charCodeAt(++a)&255)<<16|(this.charCodeAt(++a)&255)<<24,++a,d=3432918353*(d&65535)+((3432918353*(d>>>16)&65535)<<16)&4294967295,d=d<<15|d>>>17,d=461845907*(d&65535)+((461845907*(d>>>16)&65535)<<16)&4294967295,b^=d,b=b<<13|b>>>19,b=5*(b&65535)+((5*(b>>>16)&65535)<<16)&4294967295,b=(b&65535)+27492+(((b>>>16)+58964&65535)<<16);d=0;switch(c){case 3:d^=
(this.charCodeAt(a+2)&255)<<16;case 2:d^=(this.charCodeAt(a+1)&255)<<8;case 1:d^=this.charCodeAt(a)&255,d=3432918353*(d&65535)+((3432918353*(d>>>16)&65535)<<16)&4294967295,d=d<<15|d>>>17,b^=461845907*(d&65535)+((461845907*(d>>>16)&65535)<<16)&4294967295}b^=this.length;b^=b>>>16;b=2246822507*(b&65535)+((2246822507*(b>>>16)&65535)<<16)&4294967295;b^=b>>>13;b=3266489909*(b&65535)+((3266489909*(b>>>16)&65535)<<16)&4294967295;return(b^b>>>16)>>>0};
Datajet.getBid=function(){return parseInt((new Datajet.Fingerprint({canvas:!0,ie_activex:!0})).get())};Datajet=Datajet||{};Datajet.format=function(a,c){for(key in c)a=a.replace("$"+key,c[key]);return a};Datajet.feeds={};Datajet.feeds.mostViewed=function(){return{uri:"mostViewed"}};Datajet.feeds.moreLikeThis=function(a,c){return{uri:"moreLikeThis",method:c||"default",sku:a}};Datajet.feeds.boughtTogether=function(a){return{uri:"boughtTogether",sku:a}};Datajet.feeds.bestDeals=function(){return{uri:"bestDeals"}};Datajet.feeds.recentlyViewed=function(){return{uri:"recentlyViewed"}};
Datajet.feeds.bestsellers=function(a){var c={uri:"bestsellers"};"undefined"!==typeof a&&(c.category=a);return c};Datajet.feeds.specialDeals=function(){return{uri:"specialDeals"}};Datajet.feeds._itemKey="datajetItem";Datajet.feeds._pondUrl="http://pond.datajet.io";Datajet.feeds._feedsHost="http://feed.datajet.io/1.0/";Datajet.feeds._getItemUniqueKey=function(a){return a.sku};Datajet.feeds._feedsElems=[];
Datajet.feeds._visitItem=function(a){a=a.url;0!=a.indexOf("http://")&&(a="http://"+a);window.location.href=a};Datajet.feeds._logClick=function(a,c){Datajet.feeds._log(c.options.clientKey,"feeditemclicked",c.options.feed,a)};Datajet.feeds._logShow=function(a){Datajet.feeds._log(a.clientKey,"feeditemshowed",a.feed,a.item)};
Datajet.feeds._log=function(a,c,e,b){c={bid:Datajet.getBid(),event:c,itemId:Datajet.feeds._getItemUniqueKey(b),feed:e,source:"datafeed",url:window.location.href,payload:{}};navigator&&(c.client={platform:navigator.platform,agent:navigator.userAgent});a=Datajet.feeds._pondUrl+"/1.0/log?"+$.param({key:a,p:JSON.stringify(c)});$.get(a)};
(function(a){var c=function(){a.each(Datajet.feeds._feedsElems,function(c,b){b.find(".datajetCard").each(function(b,c){var e=c.getBoundingClientRect(),g=a(c).data(Datajet.feeds._itemKey);"undefined"!==typeof g&&(0<=e.top&&0<=e.left&&e.top+.6*e.height<=a(window).height()&&e.left+.6*e.width<=a(window).width()?g.inViewPort||(g.inViewPort=!0,Datajet.feeds._logShow(g)):g.inViewPort&&(g.inViewPort=!1))})})};a(window).scroll(function(){c()});a.fn.datajetFeed=function(e){e=a.extend({},a.fn.datajetFeed.defaults,
e);var b=e.feed,d=e.feed.uri;delete b.uri;var b=function(b,c){return Datajet.feeds._feedsHost+b+"?"+a.param(c)}(d,a.extend({key:e.clientKey,size:e.size,from:e.from,uuid:Datajet.getBid()},b)),h=e.renderNoResults,f=function(b,c,e){c=a("<div />",{"class":"datajetCard",id:c,click:function(){Datajet.feeds._logClick(e,b);b.options.resultClick(e)}}).data(Datajet.feeds._itemKey,{item:e,feed:d,clientKey:b.options.clientKey,inViewPort:!1});b.options.renderCardBody(c,e,b);return c},g=this,l={options:e},k=function(a){try{e.onDataArrived(a)}catch(b){}};
a.getJSON(b,function(b){g.empty();"undefined"===typeof b||null===b||0==b.length?(k([]),h(d,g)):(k(b),a.each(b,function(b,c){var h=f(l,d+"-result-"+b,c);if(e.resultCardHolder){var k=a(e.resultCardHolder);k.append(h);g.append(k)}else g.append(h)}),c())}).fail(function(a,b,c){e.feedFail(a,b,c)});Datajet.feeds._feedsElems.push(this);return this};a.fn.datajetFeed.defaults={size:5,from:"now-24h",currencyPrefix:"$",maxLenTitle:21,maxLenSubtitle:80,resultCardHolder:null,resultClick:function(a){},feedFail:function(a,
b,c){console.log(a,b,c)},onDataArrived:function(a){},renderNoResults:function(a,b){b.html(Datajet.format('<div id="noResults$id" class="noResults"><h2>Sorry, we haven\u2019t found any items to show here.</h2></div>',{id:a}))},renderCardBody:function(c,b,d){var h=d.options.maxLenTitle,f=d.options.maxLenSubtitle,g=b.title,l="";d=d.options.currencyPrefix;g.length>h&&(h=g.trunc(h,!0),l=g.substr(h.length).trunc(f,!0),g=h);f=d+b.price;h="";b.special_price&&(f=d+b.special_price,h=d+b.price);c.css({cursor:"pointer"}).append(a("<img/>",
{"class":"cardImage",src:b.image,click:function(){Datajet.feeds._visitItem(b)}})).append(a("<p/>",{"class":"cardTitle",text:g})).append(a("<p/>",{"class":"cardSubtitle",text:l})).append(a("<p/>",{"class":"cardPrice"}).append(a("<span/>",{"class":"cardCurrentPrice",text:f})).append(a("<span/>",{"class":"cardStrikedPrice",text:h}))).click(function(){Datajet.feeds._visitItem(b)})}}})(jQuery);